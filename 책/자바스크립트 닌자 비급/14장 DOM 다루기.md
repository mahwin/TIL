# 14 DOM 다루기

라이브러리에서 어떻게 DOM을 수정하는지 이해한다면, 해당 라이브러리를 사용해서 더 빠르고 좋은 코드를 작성할 수 있고, 이런 기술을 자신의 코드에서도 사용할 수 있게 되니 DOM 조작에 대해서 학습하자.

브라우저에서 동작하는 라이브러리들은 크로스 브라우저 문제를 해결하면서도 꽤 빠르게 동작한다는 점이 놀랍다. 예를 들어 createElement보다 빠른 Document fragment를 사용하거나 createContextualFragment를 사용하는 것이다.

성능 향상을 위한 다른 방법은 메모리 관리다. 웹 어플리케이션의 메모리 사용량에 대해 대부분의 개발자가 신경을 쓰지 않아도 가바지 컬렉터가 메모리 누수를 해결해주지만, 메모리 누수를 방지하는 것은 여전히 중요하다. 라이브러리의 메모리 사용량을 고려해 불필요한 중복 데이터를 생성하지 않도록 주의해야 한다.

## 14.1 DOM에 HTML 주입하기

밑바닥부터 DOM 조작 API를 구현하자

1. 임의의 그러나 올바른 HTML 문자열을 DOM 구조로 변경한다.
2. 가능한 한 효과적인 방법으로 DOM의 어떤 위치에라도 DOM 구조를 삽입한다.
3. 소스에 있는 인라인 스크립트를 실행한다.

### 14.1.1 HTML 문자열을 DOM으로 변경하기

HTML 문자열을 DOM 구조로 변경하는 데 특별한 기술이 사용되지는 않는다. innerHTML 프로퍼티를 사용하면 된다. innerHTML을 사용하면 다음 단계를 거치게 된다.

1. HTML 문자열이 올바른 HTML인지 확인한다.
   => 올바른 문자열이 아니라면 유효한 형태로 수정한다.
2. 특정 마크업으로 해당 문자열을 감싼다. 이는 브라우저 규칙 때문에 필요하다.
3. HTML 문자열을 더미 DOM 엘리먼트에 삽입한다.
4. DOM 노드를 다시 추출한다.

`HTML 소스 문자열 처리하기`

소스 HTML을 필요에 맞게 정리해야 한다.

```js
// <table /> => <table></table>로 변환해주는 코드를 작성하자.

const tags = /^(area|br|col|embed|hr|img|input|link|meta|param)$/i;

const convert = (html) => {
  return html.replace(/(<(\w+)[^>]*?)\/>/g, function (all, front, tag) {
    return tags.test(tag) ? all : front + "></" + tag + ">";
  });
};
```

`HTML 래핑`

HTML 문자열을 페이지에 삽입하기 전에, 거쳐야 할 또 다른 단계가 있다. 몇 몇 HTML 엘리먼트는 다른 컨테이너 엘리먼트로 감싸야 삽입할 수 있다.
예를 들면 `<option>` 엘리먼트는 반드시 `<select>` 엘리먼트 내부에 있어야 한다.

- innterHTML을 이용해서 문자열을 특정 부모 노드에 곧장 삽입하는 것이 가능하다. 이 때 createElement를 이용해서 부모 노드를 미리 생성해 두어야 한다.
- 문자열을 필요한 마크업으로 적절히 감싼 다음, 다른 컨테이너 엘리먼트에 삽입한다.

### 정리

DOM 조작은 대부분 현대 웹 어플리케이션 프레임워크가 대신 해주기 때문에 지금과는 너무 상황이 달라 pass합니다.
