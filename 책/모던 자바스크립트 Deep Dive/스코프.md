# 스코프

## 스코프란?

스코프는 변수의 유효 범위를 의미한다. 변수는 자신이 선언된 위치에 의해 자신의 유효범위가 결정된다.

모든 식별자는 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정된다. `스코프는 식별자가 유효한 범위`를 말한다.

## 스코프의 종류

스코프는 전역 스코프와 지역 스코프로 구분된다.

## 스코프 체인

스코프는 계층적으로 구조를 가진다. 모든 스코프의 최상위는 전역 스코프다. 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색한다.

자바스크립트 엔진은 코드를 실행하기에 앞서 렉시컬 환경을 생성한다. 변수 선언이 실행되면 변수 식별자가 이 자료구조에 키로 등록되고, 변수 할당이 일어나면 이 자료구조의 변수 식별자에 해당하는 값을 할당한다.

> 스코프 체인은 실행 컨텍스트의 렉시컬 환경을 단방향으로 연결한 것이다.

## 함수 레벨 스코프

함수 내부에서 선언된 변수는 함수 외부에서는 참조할 수 없다. 이를 `함수 레벨 스코프`라 한다.

`블록 레벨 스코프`는 함수 레벨 스코프와 달리 블록 내부에서 선언된 변수는 블록 외부에서 참조할 수 없다.

var 키워드로 선언한 변수는 함수의 몸체 내부에서만 지역 스코프로 인정된다. 함수 블록 밖에서 사용된 var 변수는 모두 지역 변수이다.

```javascript
function A() {
  var a = 3;
}
if (true) {
  var b = 5;
}
A();

console.log(a); // ReferenceError: a is not defined
console.log(b); // 5
```

ES6에서 도입된 let, const 키워드로 선언한 변수는 블록 레벨 스코프를 가진다.

```javascript
function A() {
  let a = 4;
}
if (true) {
  let b = 5;
}
A();

console.log(a); // ReferenceError: a is not defined
console.log(b); // ReferenceError: b is not defined
```

## 렉시컬 스코프

상위 스코프를 예측할 때 렉시컬 환경을 참조하는 것을 `렉시컬 스코프`라 한다.

함수의 상위 스코프는 다음과 같은 방법으로 정해진다.

1. `함수를 어디서 호출`했는지에 따라 함수의 상위 스코프가 결정된다.
2. `함수를 어디서 정의`했는지에 따라 함수의 상위 스코프가 결정된다.

호출을 기준으로 상위 스코프를 결정하는 것을 동적 스코프라 한다. 두 번째 방식을 렉시컬 스코프 또는 정적 스코프라 한다. 대부분의 프로그래밍 언어는 렉시컬 스코프를 따르고 자바스크립트도 마찬가지이다.

함수를 어디서 정의했는지에 따라 스코프가 정해진다. 함수의 상위 스코프는 언젠나 자신이 정의된 스코프이다.

```javascript
const b = 4;
function outer() {
  const b = 3;
  return function inner() {
    console.log(b);
  };
  inner();
}

const inner = outer();
inner(); // 3
```

만약 동적 스코프 였다면, outer가 리턴한 함수는 전역객체의 b를 바라봤을 것이다.
