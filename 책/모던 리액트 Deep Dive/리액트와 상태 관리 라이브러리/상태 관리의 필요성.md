## 상태 관리는 왜 필요한가?

상태가 무엇인지 부터 정의하자. 상태란 ?

상호작용이 가능한 요소의 현재 값을 의미한다.

1. UI: 기본적으로 웹 애플리케이션에서 상태라 함은 상호 작용이 가능한 모든 요소의 현재 값을 의미한다. 다크/라이트 모드, 라이도를 비롯한 각종 Input, 알림창의 노출 여부 등..
2. URL: 브라우저에서 관리되고 있는 상태값으로, URL도 많은 상태 값을 담고 있다.
3. 폼: 폼에도 상태가 존재한다. 로딩 중인지, 현재 제출됐는지, 접근이 불가능한지, 값이 유효한지 등 모두가 상태로 관리된다.
4. 서버에서 가져온 값: 클라이언트가 API 요청으로 가져온 값들도 상태값이다.

전체적으로 관리해야 할 상태가 있다고 가정해보자. 당연히 상태에 맞는 UI를 보여줘야한다. 그렇다면 해당 상태에 대한 값을 어디다 저장해야할까? 전역, 클로저? 그리고 이러한 상태값에 대한 변경을 어떻게 UI에 반영할 수 있을까? 반영한다면 언제 반영해야할까? 이처럼 현대 웹 애플리케이션에서 상태 관리란 매우 어려운 과업이 됐다.

### 리액트 상태 관리의 역사

Flux 패턴의 등장

리액트 개발 팀은 웹 애플리케이션이 비대해지고 상태도 많아짐에 따라 어디서 어떤 일이 일어나서 이 상태가 됐는지 추적하기 매우 어려운 상황이었다.

페이스북은 이러한 문제의 원인을 양방향 데이터 바인딩으로 봤다. HTML(뷰)가 Javascript(모델)을 변경할 수 있으며, 반대도 가능했다. 이러한 코드는 기능을 구현하는 데에는 간단할 수 있지만, 코드 양이 많아지고 변경 시나리오가 복잡해질수록 관리가 어려워졌고 데이터의 흐름(상태)를 적절히 관리하기 어려웠다. 이를 해결하기 위해 단방향 데이터 흐름을 제안했다.

#### Flux 패턴의 구조

<img width="828" alt="스크린샷 2024-04-25 오전 10 01 06" src="https://gist.github.com/assets/78193416/2bda471d-21b5-4bad-861a-5daaeec18768">

- Action: 어떠한 작업을 처리할 액션과 그 액션 발생 시 함께 포함시킬 데이터를 의미한다. 액션 타입과 데이터를 각각 정의해 이를 디스패처로 보낸다.
- Dispatcher: 액션을 스토어에 보내는 역할을 한다. 콜백 함수 형태로 앞서 액션이 정의한 타입과 데이터를 모두 스토어에 전달한다.
- Store: 여기에서 실제 상태에 대한 값과 상태를 변경할 수 있는 메서드를 가지고 있다. 액션의 타입에 따라 어떻게 이를 변경할지가 정의됨
- View: 리액트의 컴포넌트에 해당하는 부분으로 스토어에서 만들어진 데이터를 가져와 화면을 렌더링하는 역할을 한다. 뷰에서 사용자의 행위에 따라 Action을 호출할 수 있다.

#### 시장 지배자 리덕스

리덕스는 Flux 구조를 구현하기 위해 만들어졌다. 이에 한 가지 더 Elm 아키텍처를 도입했다.

Elm 은 model, update, view이 세 가지로 구성된 아키텍처이다.

- model : 애플리케이션의 상태를 의미한다. 초기값은 0
- view : 모델을 표현하는 HTML을 말한다.
- update : 모델을 수정하는 방식을 말한다.

Elm안 Flux와 마찬가지로 데이트 흐름을 세 가지로 분류하고, 이를 단방향으로 강제해 웹 애플리케이션의 상태를 안정적으로 관리하고자 노력했다. 리덕스는 Elm 아키텍처의 영향을 많이 받았다.

하지만 리덕스는 단순한 상태 변경에도 수많은 보일러 플레이트 코드를 작성해야 했다. 현재는 이를 리덕스 툴킷으로 해결하고 있지만, 여전히 복잡하다.

#### Context API와 useContext

리액트 16.3에서 전역 상태를 하위 컴포넌트에 주입할 수 있는 새로운 Context API를 출시했다. props로 상태를 넘겨주지 않고 Context API를 사용하면 원하는 곳에서 Context Provider로 상태를 주입할 수 있다.

하지만, 상태를 관리하는 API가 아니라 주입하는 API이며, 리랜더링을 막는 기능 또한 존재하지 않는다.

#### 훅의 탄생, 그리고 React Query와 SWR

React Query와 SWR 모두 데이터를 fetch하는 데에 특화된 상태관리 라이브러리이다. HTTP 요청에 대해서만 관리해준다.

#### Recoil, Zustand, Jotai, Valtio

훅을 활용해 상태를 가져오거나 관리할 수 있는 다양한 라이브러리가 등장하게 된다. Redux와 차이점은 작은 크기의 상태를 효율적으로 관리할 수 있다는 점이다.

해당 라이브러리들은 peerDependencies로 리액트 16.8 버전 이상을 요구한다. 즉, 훅을 사용할 수 있는 환경에서만 사용할 수 있다.
