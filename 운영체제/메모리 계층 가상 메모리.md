### 메모리 계층

메모리 계층은 레지스터, 캐시, 주기억장치, 보조기억장치로 구성된다.

- 레지스터 : CPU 내의 작은 메모리로 가장 빠르지만 가장 비싸다.
- 캐시 : CPU내의 L1,L2 캐시를 지칭한다. CPU와 주기억장치 사이에 위치하며, 주기억장치보다 빠르지만 레지스터보다 느리다.
- 주기억장치 : RAM을 가리킨다.
- 보조기억장치 : 하드디스크, SSD를 가리킨다.

### 계층이 존재하는 이유

대부분 사용하던 프로세스를 다시 사용한다는 인간행동과 관련되어있다. 이러한 특성을 이용하여 메모리를 계층으로 구성해서, 값이 비싸지만 빠른 메모리에 자주 사용하는 데이터를 저장하고, 값이 싸지만 느린 메모리에 자주 사용하지 않는 데이터를 저장해 비용도 줄이고, 처리속도도 증가 시킬 수 있다.

### 가상메모리와 스와핑, 페이지폴트 그리고 스레싱

가상메모리는 OS에서 사용되는 메모리 관리 기법의 하나로 컴퓨터가 실제로 이용가능한 메모리 자원을 추상화하여 이를 사용하는 사용자들에게 매우 큰 메모리로 보이게 만드는 것을 의미한다.

- 가상메모리는 MMU와 페이지테이블에 의해 실제 주소로 변환된다.
- 페이지 : 가상 메모리를 사용하는 최소 크기 단위
- 프레임 : 실제 디스크나 메머ㅗ리를 사용하는 최소 크기 단위

### 페이지테이블

가상 메모리는 가상주소와 실제주소가 매핑되어있는 페이지 테이블로 관리되며 이 때 속도 향상을 위해 캐싱계층인 TLB를 사용한다.

가상 주소에서 TLB에 해당하는 페이지가 있는지 확인 후 없으면 페이지테이블로가서 실제 주소를 찾아낸다.

![스크린샷 2024-03-12 오전 10 54 54](https://gist.github.com/assets/78193416/9c28a220-b4d3-40be-91de-e881c544d9fb)

### 페이지폴트와 스와핑

가상 메모리는 실제 메모리보다 더 큰 메모리로 보이게끔하는 것이라 메모리 영역에 올라가지 않은 페이지가 있을 수 있다. 가상 메모리에는 존재하지만 실제 RAM에는 없는 경우를 페이지 폴트가 발생했다고 한다.

실제 램에서 사용하지 않는 부분을 하드디스크로 내리고 필요한 부분을 다시 램에 올리는 것을 스와핑이라고 한다.

### 페이지 폴트의 과정

1. 페이지 폴트가 발생하면 CPU는 인터럽트를 발생시킨다.
2. OS가 페이지 폴트를 처리하기 위해 디스크에서 해당 프레임을 찾아 램에 올린다.
   - 페이지교체알고리즘 사용, 스와핑 일어남
3. 페이지 테이블을 수정한다.
4. 다시 해당 프로세스를 실행한다.

### 스레싱

스레싱은 메모리의 페이지 폴트율이 높은 것을 의미한다. 스레싱은 메모리에 너무 많은 프로세스가 동시에 올라가게 되면 스와핑이 많이 일어나고, CPU 이용률은 떨어진다. CPU 이용률이 떨어지면 OS는 CPU 가용성을 높이기 위해 더 많은 프로세스를 올려 페이지 폴트율이 더 높아지는 악순환이 생긴다.

해결방법

- 하드웨어적 :메모리를 늘리거나 HDD라면 SSD를 사용한다.
- os적 : 작업세트, PFF

### 작업세트

작업세트는 프로세스의 과거 사용이력을 기반으로 많이 사용하는 페이지집합을 한꺼번에 미리 로드하는 방법을 말한다.

### PFF

PFF는 페이지 폴트 빈도를 기반으로 페이지를 교체하는 알고리즘을 말한다.

### 가상 메모리의 필요성

가상 메모리는 실제 메모리보다 더 큰 메모리로 보이게끔 하는 것이다. 이는 다음과 같은 이점이 있다.

- 하드디스크를 주기억장치에 대한 캐시로 설정하여 주기억장치의 크기를 늘릴 수 있다.

- 프로세스간의 메모리를 분리할 수 있다.
- 각 프로세스마다 가상메모리의 통일된 주소 공간을 배정할 수 있으므로 메모리 관리가 단순해진다.

### 페이지 교체 알고리즘

#### 오프라인알고리즘

가장 먼 미래에 참조되는 페이지와 현재의 페이지를 바꾸는 알고리즘으로 실제로 사용될 순 없지만, 다른 페이지 교체 알고리즘의 성능을 평가하는 기준으로 사용된다.

#### FIFO

가장 먼저 들어온 페이지를 교체하는 알고리즘으로, 페이지 폴트율이 높은 단점이 있다.

#### LRU

가장 오랫동안 참조되지 않은 페이지를 교체하는 알고리즘으로, 페이지 폴트율이 낮은 장점이 있다.

#### NUR

LRU의 단점을 보완한 알고리즘으로, 최근에 참조되지 않은 페이지를 교체하는 알고리즘이다.

#### LFU

가장 적게 참조된 페이지를 교체하는 알고리즘으로, 페이지 폴트율이 낮은 장점이 있다.

### 출처

CS 지식의 정석 | 디자인패턴 네트워크 운영체제 데이터베이스 자료구조 (최홍철)
