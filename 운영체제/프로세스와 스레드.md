### 프로세스

컴퓨터의 메모리에 올라와 실행되고 있는 프로그램, task와 같은 의미이다.

### 스레드

프로세스 내 작업의 흐름을 지칭한다.

![스크린샷 2024-03-12 오전 11 33 12](https://gist.github.com/assets/78193416/34cf4875-069a-4e2a-a705-cbbf164fb4b9)

### 프로세스와 스레드의 차이

1. 프로세스는 코드, 데이터, 스택, 힙 메모리 영역을 기반으로 작업하는 반면 스레드는 프로세스 내의 스택 메모리를 제외한 다른 메모리 영역을 프로세스 내의 다른 스레드들과 공유하기 때문에 메모리적 이점이 있다.
2. 프로세는 다른 프로세스와 격리되어있기 때문에 서로 통신을 하기 위해서는 IPC를 사용해야 하지만 스레드는 다른 스레드와 서로 격리되어있지 않아 그냥 통신할 수 있다.
3. 프로세스는 한 프로세스에 문제가 생겨도 다른 프로세스에 영향을 끼치지 않지만 스레드는 한 스레드에 문제가 생기면 다른 스레드에 영향을 끼친다.

### 프로세스의 메모리 구조

운영체제는 프로세스에 적절한 메모리를 할당하는데 스택, 힙, 데이터 영역, 코드 영역으로 나눠진다. 스택은 위 주소부터 할당되고 힙은 아래 주소부터 할당된다.

![스크린샷 2024-03-12 오전 11 43 34](https://gist.github.com/assets/78193416/c1941441-03d9-4376-a71b-dd46587e21be)

- 스택 : 지역변수, 매개변수, 함수가 저장되고 컴파일 시에 크기가 결정된다. 함수가 함수를 호출하는 등에 따른 런타임시에도 크기가 변경된다.
- 힙 : 동적으로 할당되는 메모리로 크기가 런타임시에 결정된다.
- 데이터영역 : BBS 세그먼트와 Data 세그먼트로 구성되어 있으며 정적할당에 관한 부분을 담당한다.
- 코드영역 : 프로그램의 코드가 저장되는 영역이다.

### 정적할당

정적할당은 컴파일 단계에서 메모리를 할당하는 것을 말한다.

- BBS 세그먼트 : 전역변수, static, const로 선언되어있는 변수 중 0으로 초기화 또는 초기화가 어떠한 값으로도 되어 있지 않은 변수들이 저장됨
- Data 세그먼트 : 전역변수, static, const로 선언되어있는 변수 중 0이 아닌 값으로 초기화된 변수가 저장

### 동적할당

동적할당은 런타임시에 메모리를 할당받는 것을 의미한다.

- Stack : 지역변수, 매개변수, 실행되는 함수에 의해 늘어나거나 줄어드는 메모리 영역이다. 함수가 호출될 때마다 호출될 때의 환경 등 특정 정보가 stack에 계속해서 저장된다. 재귀함수가 호출된다고 했을 때 새로운 스택 프레임이 매번 사용되기 때문에 함수 내의 변수 집합이 해당 함수의 다른 인스턴스 변수를 방해하지는 않는다.
- Heap : 동적할당된 메모리가 저장되는 영역이다. malloc, calloc, realloc, free 등의 함수를 통해 메모리를 할당하고 해제한다. 동적으로 관리되는 자료구조의 경우 Heap 영역을 사용한다. ex) 벡터는 내부적으로 heap 영역을 사용함.

### 프로세스의 상태

프로세스는 create, ready, waiting ( ready suspend, blocked, blocked suspended ), running, terminated의 상태를 가진다.

![스크린샷 2024-03-12 오후 4 04 11](https://gist.github.com/assets/78193416/68b90a6b-6029-45ae-badf-ce40671ca7cc)

- create는 프로세스가 생성된 상태를 의미하며, fork() 또는 exec() 함수를 통해 프로세스가 생성된 상태이다. 이때 PCB가 할당된다.
  - fork()는 부모 프로세스의 주소 공간을 그대로 복사하며, 새로운 자식 프로세스를 생성하는 함수
  - exec()는 새로운 프로세스를 생성하는 함수
- ready는 프로세스가 생성되고 메모리 공간이 충분하면 메모리를 할당받고 아니면 준비 큐에 들어가서 간다. CPU 스케줄러로부터 CPU 소유권이 넘어오기를 기다리는 상태이다.
- waiting은 ready suspended, blocked, blocked suspended로 구성된다.
  - ready suspended는 준비큐가 꽉찬 상태로 메모리 부족으로 일시 중단된 상태를 의미한다.
  - blocked의 경우 running되던 프로세스가 인터럽트가 발생했을 때를 의미한다.
  - blocked suspended는 blocked 상태에서 다시 실행되려 했지만, 메모리 부족으로 인해 일시 중단된 상태를 의미한다.
- running는 CPU 소유권과 메모리를 할당받고 인스트럭션을 수행 중인 상태를 의미한다.
- terminated는 프로세스가 종료된 상태를 의미한다. 프로세스에 대한 자원을 반납하며 PCB가 삭제된다.

## 멀티프로세싱과 멀티스레딩

### 멀티프로세싱

여러 개의 '프로세스' 가 동시에 실행되는 것을 의미한다. 각 프로세스는 독립적으로 실행되며, 각 프로세스는 각자의 주소공간을 가지고 있다. 이는 각 프로세스가 독립적으로 실행되기 때문에 서로 통신하기 위해서는 IPC를 사용해야 한다. 특정 프로세스 중 일부에 문제가 발생되더라도 다른 프로세스에 영향을 끼치지 않는 격리성과 신뢰성이 높은 장점이 있다.

### 멀티스레딩

프로세스 내 작업을 멀티스레드로 처리하는 기법이며 서로 자원을 공유하고 프로세스보다는 가볍기 때문에 효율성이 높은 장점이 있다. 하지만 스레드 중 하나에 문제가 발생하면 다른 스레드에 영향을 끼치기 때문에 신뢰성이 낮은 단점이 있다.

### 브라우저는 멀티프로세스이자 멀티스레드 아키텍처를 가진 소프트웨어다.

![스크린샷 2024-03-12 오후 4 19 01](https://gist.github.com/assets/78193416/0f26f491-2a4b-45d8-b229-3e2f7c33ab07)

![스크린샷 2024-03-12 오후 4 19 47](https://gist.github.com/assets/78193416/051ad717-08a8-4927-8cb1-6b9ed613ad76)

## IPC (Inter Process Communication)

IPC란 프로세스끼리 데이터를 주고받고 공유 데이터를 관리하는 메커니즘이다. 프로세스는 독립적으로 실행되기 때문에 서로 통신하기 위해서는 IPC를 사용해야 한다. 종류로는 공유메모리, 파일, 소켓, 파이프, 메시지 큐가 있다.

### 공유메모리

여러 프로세스가 서로 통신할 수 있도록 메모리를 공유하는 것을 의미한다. 메모리 자체를 공유하기 때문에 불필요한 데이터 복사의 오버헤드가 발생하지 않고, 가장 빠르지만 메모리 영역을 여러 프로세스가 공유하기 때문에 동기화가 필요하다.

### 파일

디스크에 저장된 데이터를 기반으로 통신하는 것을 의미한다.

### 소켓

네트워크 인터페이스를 기반으로 통신하는 것을 의미한다. (TCP, UDP, HTTP 등)

### 익명 파이프

익명 파이프는 프로세스 사이에 FIFO 기반의 통신채널을 만들어 통신하는 것을 말한다. 파이프는 단방향이기 때문에 양방향 통신을 하려면 2개의 익명 파이프를 만들어야 한다. 부모, 자식 프로세스 간에만 사용할 수 있으며 다른 네트워크 상에서는 사용이 불가능하다.

### 명명 파이프

명명파이프는 익명 파이프의 확장된 개념이며 부모, 자식 뿐만 아니라 다른 네트워크 상에서도 통신할 수 있는 파이프를 말한다.

### 메시지 큐

메시지를 큐 형태로 관리하는 버퍼를 만들어 통신하는 것을 말함. 보내는 프로세스의 메시지는 큐에 버퍼형식으로 복사되어 프로세스에게 전달된다.

### 출처

CS 지식의 정석 | 디자인패턴 네트워크 운영체제 데이터베이스 자료구조 (최홍철)
